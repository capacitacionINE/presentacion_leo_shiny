library(ene)
library(calidad)
library(survey)
library(tidyverse)
#devtools::install_github("Klauslehmann/calidad")

# Obtener datos directamente de la página del INE
ene_9 <-  ene::get_microdata(year = 2020, month = 9)

#Setear el diseño muestral
ene <- ene_9 %>%
  mutate(ocupado = if_else(cae_especifico >= 1 & cae_especifico <= 7, 1, 0),
         fdt = if_else(cae_especifico >= 1 & cae_especifico <=9, 1, 0 ),
         desocupado = if_else(cae_especifico >= 8 & cae_especifico <= 9, 1, 0)) %>%
  rename(varunit = conglomerado,
         varstrat = estrato,
         fe = fact_cal)

# Definir el diseño complejo


#####################
#DEMOSTRACIÓN CALIDAD
#####################

# INSTALACIÓN Y DESEÑO MUESTRAL

devtools::install_github("Klauslehmann/calidad")

options(survey.lonely.psu = "certainty")

dc <- svydesign(ids = ~varunit, strata = ~varstrat, data = ene, weights = ~fe)

# TASA DE DESOCUPACIÓN (ESTIMADOR DE PROPORCIÓN)
sexo <- crear_insumos_prop(desocupado, fdt+sexo+region, dc)
sexo <- crear_insumos_prop(desocupado, sexo, fdt, dc)


View(sexo)

# EVALUAR ESTIMACIÓN DE PROPORCIÓN

evaluacion_calidad_prop(sexo) %>%
  View()

# TOTAL DE DESOCUPADOS (ESTIMACIÓN DE NIVEL)
desocupados_region <- crear_insumos_tot(var = desocupado, dominios = region+sexo, disenio = dc)
desocupados_region <- crear_insumos_tot(var = region, disenio = dc)

View(desocupados_region)

eval_desocupa_region <-  evaluacion_calidad_tot(desocupados_region)

View(eval_desocupa_region)

# VISUALIZACIÓN

tabla_html(eval_desocupa_region)



